{
  "openapi": "3.0.3",
  "info": {
    "title": "mysupply Public API",
    "version": "0.1.0"
  },
  "servers": [
    {
      "url": "/v1"
    }
  ],
  "security": [
    {
      "BearerAuth": []
    }
  ],
  "paths": {
    "/demands": {
      "post": {
        "summary": "Submit a new demand",
        "tags": ["Demands"],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "allOf": [
                  {
                    "$ref": "#/components/schemas/newDemand"
                  }
                ]
              },
              "example": {
                "title": "Office Chairs",
                "quantity": 20,
                "unitOfMeasure": "piece",
                "fields": [
                  {
                    "name": "internalId",
                    "value": "8937182",
                    "public": false
                  },
                  {
                    "name": "Delivery Date",
                    "value": "2023-11-22",
                    "public": true,
                    "type": "date"
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Demand was created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "description": "The mysupply ID assigned to the demand",
                      "type": "string"
                    }
                  }
                },
                "example": {
                  "id": "83da61b6-e11e-495d-9808-3e1ff7869c19"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input"
          },
          "422": {
            "description": "Unprocessable entity"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "get": {
        "summary": "Fetch a paginated list of demands",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer"
            },
            "description": "The number of the page to fetch starting at 1"
          }
        ],
        "tags": ["Demands"],
        "responses": {
          "200": {
            "description": "A list of demands",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/savedDemand" }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/demands/{id}": {
      "parameters": [
        {
          "$ref": "#/components/parameters/demandId"
        }
      ],
      "get": {
        "tags": ["Demands"],
        "summary": "Returns information for a specific demand",
        "responses": {
          "200": {
            "description": "Information for the demand",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/savedDemand"},
                "example": {
                  "id": "83da61b6-e11e-495d-9808-3e1ff7869c19",
                  "title": "Office Chairs",
                  "quantity": "20",
                  "unitOfMeasure": "piece",
                  "fields": [
                    {
                      "name": "internalId",
                      "value": "8937182",
                      "public": false
                    },
                    {
                      "name": "Delivery Date",
                      "value": "Wed Sep 20 2023 03:00:00 GMT+0300 (Eastern European Summer Time)",
                      "public": true,
                      "type": "date"
                    }
                  ],
                  "status": "processed",
                  "deal": {
                    "unitPrice": {
                      "amount": 200,
                      "currency": "EUR"
                    },
                    "supplier": {
                      "email": "the-winner@chairs.com",
                      "supplierNumber": "ex-993841",
                      "companyName": "The Best Chairs & Sons Ltd."
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "A demand with such ID has not been found"
          }
        }
      }
    },
    "/demands/{id}/deal": {
      "parameters": [
        {
          "$ref": "#/components/parameters/demandId"
        }
      ],
      "get": {
        "tags": ["Demands"],
        "summary": "Returns information for a deal made for a demand",
        "responses": {
          "200": {
            "description": "Information for deal",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/deal"},
                "example": {
                  "unitPrice": {
                    "amount": "200",
                    "currency": "EUR"
                  },
                  "supplier": {
                    "email": "the-winner@chairs.com",
                    "supplierNumber": "ex-993841",
                    "companyName": "The Best Chairs & Sons Ltd."
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "A demand with such ID has not been found"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Access token is missing or invalid"
      }
    },
    "parameters": {
      "demandId": {
        "name": "id",
        "in": "path",
        "description": "The mysupply ID of the demand",
        "required": true,
        "allowEmptyValue": false,
        "schema": {
          "type": "string"
        },
        "example": "83da61b6-e11e-495d-9808-3e1ff7869c19"
      }
    },
    "schemas": {
      "newDemand": {
        "type": "object",
        "description": "An item which needs to be procured (a purchase requisition).",
        "properties": {
          "title": {
            "type": "string",
            "description": "A brief explanation of the demand.",
            "example": "Office Chairs"
          },
          "quantity": {
            "allOf": [ { "$ref": "#/components/schemas/decimal" } ],
            "description": "The quantity needed.",
            "example": 20
          },
          "unitOfMeasure": {
            "allOf": [ { "$ref": "#/components/schemas/unitOfMeasure" } ],
            "example": "piece"
          },
          "fields": {
            "description": "Arbitrary data related to the item.",
            "type": "array",
            "items": {
              "type": "object",
              "description": "A single field with extra information about the demand.",
              "properties": {
                "name": {
                  "type": "string",
                  "description": "The name of the field.",
                  "example": "lastPrice"
                },
                "value": {
                  "type": "string",
                  "description": "The value of the field.",
                  "example": "{\"amoutn\": \"219.99\", \"currency\": \"EUR\"}"
                },
                "public": {
                  "type": "boolean",
                  "description": "If ture - the field will be displayed to supplier. Otherwise, the field will be visible only to members of the purchasing organization.",
                  "example": false
                },
                "type": {
                  "enum": ["text", "date", "number", "price", "address"],
                  "default": "text",
                  "description": "A hint on how to render the value to users. If the type is price and the value must conform to the Price schema of the current API. If the type is date, the value must be an ISO 8601 date.",
                  "example": "price"
                }
              },
              "required": ["name", "value", "public"]
            }
          }
        },
        "required": ["title", "quantity", "unitOfMeasure", "fields"]
      },
      "savedDemand": {
        "type": "object",
        "allOf": [ { "$ref": "#/components/schemas/newDemand"} ],
        "description": "A demand which has been saved in the mysupply DB",
        "properties": {
          "id": {
            "type": "string",
            "readOnly": true,
            "description": "The mysupply ID of the demand",
            "example": "83da61b6-e11e-495d-9808-3e1ff7869c19"
          },
          "status": {
            "enum": ["awaiting", "processing", "processed", "archived"],
            "readOnly": true,
            "description": "The status of the demand.",
            "example": "processed"
          }
        }
      },
      "unitOfMeasure": {
        "type": "string",
        "description": "The unit of measure for the quantity needed.",
        "enum": [
          "centimeter",
          "cubic-centimeter",
          "cubic-meter",
          "gram",
          "meter",
          "millimeter",
          "square-meter",
          "kilogram",
          "kilowatt-hour",
          "liter",
          "piece",
          "square-centimeter",
          "ton",
          "minute",
          "hour",
          "day",
          "month",
          "other"
        ],
        "example": "piece"
      },
      "deal": {
        "type": "object",
        "readOnly": true,
        "nullable": true,
        "description": "Information about the supplier delivering the item and the price of the deal",
        "properties": {
          "unitPrice": {
            "readOnly": true,
            "description": "The price for a single unit of the demand.",
            "allOf": [ { "$ref": "#/components/schemas/price" } ]
          },
          "supplier": {
            "nullable": true,
            "readOnly": true,
            "type": "object",
            "description": "Information about the supplier delivering the demand",
            "properties": {
              "email": {
                "type": "string",
                "readOnly": true,
                "example": "the-best@chairs.com"
              },
              "supplierNumber": {
                "type": "string",
                "readOnly": true,
                "description": "The supplier number provided by the purchaser's organization. If no such number is provided, a default one will be set",
                "example": "sup-99310"
              },
              "companyName": {
                "type": "string",
                "readOnly": true,
                "description": "The name of the company of the supplier as provided by the supplier.",
                "example": "The Best Chairs & Sons Ltd."
              }
            }
          }
        }
      },
      "price": {
        "type": "object",
        "description": "A monetary value.",
        "properties": {
          "amount": { "$ref": "#/components/schemas/decimal" },
          "currency": {
            "type": "string",
            "description": "The currency code of the monetary value.",
            "example": "EUR"
          }
        }
      },
      "decimal": {
        "type": "string",
        "format": "{1,9}+(\\.\\d+)?",
        "description": "A decimal string representation of a number with fixed precision.",
        "example": "17.05"
      }
    }
  }
}
