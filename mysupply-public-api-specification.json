{
  "openapi": "3.0.3",
  "info": {
    "title": "mysupply Public API",
    "version": "0.1.0"
  },
  "servers": [
    {
      "url": "/v1"
    }
  ],
  "security": [
    {
      "BearerAuth": []
    }
  ],
  "paths": {
    "/demands": {
      "post": {
        "summary": "Submit a new demand",
        "tags": ["Demands"],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "allOf": [
                  {
                    "$ref": "#/components/schemas/newDemand"
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Demand was created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "description": "The mysupply ID assigned to the demand",
                      "type": "string"
                    }
                  }
                },
                "example": {
                  "id": "83da61b6-e11e-495d-9808-3e1ff7869c19"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input"
          },
          "422": {
            "description": "Unprocessable entity"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      },
      "get": {
        "summary": "Fetch a paginated list of demands",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer"
            },
            "description": "The number of the page to fetch starting at 1"
          }
        ],
        "tags": ["Demands"],
        "responses": {
          "200": {
            "description": "A list of demands",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/savedDemand" }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/demands/archive": {
      "post": {
        "summary": "Archive demands",
        "tags": ["Demands"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "allOf": [
                  {
                    "$ref": "#/components/schemas/archiveDemand"
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "Demands successfully archived."
          },
          "400": {
            "description": "Invalid input"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "409": {
            "description": "Conflict occurred (e.g., demand is already archived)."
          },
          "422": {
            "description": "Unprocessable entity"
          }
        }
      }
    },
    "/demands/{id}": {
      "parameters": [
        {
          "$ref": "#/components/parameters/demandId"
        }
      ],
      "get": {
        "tags": ["Demands"],
        "summary": "Returns information for a specific demand",
        "responses": {
          "200": {
            "description": "Information for the demand",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/savedDemand"}
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "A demand with such ID has not been found"
          }
        }
      },
      "patch": {
        "tags": ["Demands"],
        "summary": "Edit a specific demand",
        "description": "",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "allOf": [
                  {
                    "$ref": "#/components/schemas/editDemand"
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Information for the demand",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/editedDemand"}
              }
            }
          }
        }
      }
    },
    "/demands/{id}/add-offer": {
      "parameters": [
        {
          "$ref": "#/components/parameters/demandId"
        }
      ],
      "put": {
        "tags": ["Demands"],
        "summary": "Add offer for a specific demand",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "allOf": [
                  {
                    "$ref": "#/components/schemas/addOffer"
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Information for the demand",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/savedDemand"}
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "A demand with such ID has not been found"
          }
        }
      }
    },
    "/demands/{id}/remove-offer": {
      "parameters": [
        {
          "$ref": "#/components/parameters/demandId"
        }
      ],
      "put": {
        "tags": ["Demands"],
        "summary": "Remove offer from a specific demand",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "An item which needs to be procured (a purchase requisition).",
                "required": ["email"],
                "properties": {
                  "email": {
                    "type": "string",
                    "description": "Supplier email address",
                    "example": "supplier3@email.com"
                  }
                }
              },
              "example": {
                "email": "supplier3@example.com"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Information for the demand",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/savedDemand"}
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "A demand with such ID has not been found"
          }
        }
      }
    },
    "/demands/{id}/deal": {
      "parameters": [
        {
          "$ref": "#/components/parameters/demandId"
        }
      ],
      "get": {
        "tags": ["Demands"],
        "summary": "Returns information for a deal made for a demand",
        "responses": {
          "200": {
            "description": "Information for deal",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/deal"},
                "example": {
                  "demandId": "3fa85f64-5717-4562-b3fc-2c963f66afa6",
                  "hasDeal": true,
                  "totalPrice": {
                    "amount": "600",
                    "currency": "EUR"
                  },
                  "unitPrice": {
                    "amount": "200",
                    "currency": "EUR"
                  },
                  "supplier": {
                    "email": "the-winner@chairs.com",
                    "supplierNumber": "ex-993841",
                    "companyName": "The Best Chairs & Sons Ltd."
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "A demand with such ID has not been found"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Access token is missing or invalid"
      }
    },
    "parameters": {
      "demandId": {
        "name": "id",
        "in": "path",
        "description": "The mysupply ID of the demand",
        "required": true,
        "allowEmptyValue": false,
        "schema": {
          "type": "string"
        },
        "example": "83da61b6-e11e-495d-9808-3e1ff7869c19"
      }
    },
    "schemas": {
      "newDemand": {
        "type": "object",
        "description": "An item which needs to be procured (a purchase requisition).",
        "properties": {
          "title": {
            "type": "string",
            "description": "A brief explanation of the demand.",
            "example": "Office Chairs"
          },
          "quantity": {
            "allOf": [ { "$ref": "#/components/schemas/decimal" } ],
            "description": "The quantity needed.",
            "example": 20
          },
          "unitOfMeasure": {
            "allOf": [ { "$ref": "#/components/schemas/unitOfMeasure" } ],
            "example": "piece"
          },
          "demandSuppliers":{
            "type": "array",
            "description": "Suppliers list",
            "items": {
              "type": "object",
              "properties": {
                "email" : {
                  "type": "string",
                  "description": "Supplier email address",
                  "example": "supplier@email.com"
                }
              }
            }
          },
          "demandOffers":{
            "type": "array",
            "description": "Demand offers list",
            "items": {
              "type": "object",
              "required": ["supplier", "unitPrice"],
              "properties": {
                "supplier": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/supplier"
                    }
                  ]
                },
                "unitPrice": {
                  "description": "The price for a single unit of the demand.",
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/price"
                    }
                  ]
                },
                "attachments": {
                  "description": "Attachments list",
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "content": {
                        "type": "string",
                        "format": "base64",
                        "example": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAcCAYAAAB"
                      },
                      "name": {
                        "type": "string",
                        "example": "example.pdf"
                      }
                    }
                  }
                }
              }
            }
          },
          "fields": {
            "description": "Custom fields list",
            "allOf": [ { "$ref": "#/components/schemas/requestFields" } ]
          }
        },
        "required": ["title", "quantity", "unitOfMeasure"]
      },
      "editDemand": {
        "type": "object",
        "description": "The new values for the item which needs to be edited",
        "properties": {
          "title": {
            "type": "string",
            "description": "A brief explanation of the demand.",
            "example": "Office Chairs"
          },
          "quantity": {
            "allOf": [ { "$ref": "#/components/schemas/decimal" } ],
            "description": "The quantity needed.",
            "example": 20
          },
          "unit": {
            "allOf": [ { "$ref": "#/components/schemas/unitOfMeasure" } ],
            "example": "piece"
          },
          "fields": {
            "description": "Custom fields list",
            "allOf": [ { "$ref": "#/components/schemas/editRequestFields" } ]
          },
          "demandSuppliers": {
            "type": "array",
            "description": "Suppliers list",
            "items": {
              "type": "object",
              "properties": {
                "email" : {
                  "type": "string",
                  "description": "Supplier email address",
                  "example": "supplier@email.com"
                }
              }
            }
          },
          "description": {
            "type": "string",
            "description": "A brief explanation of the demand.",
            "example": "Office Chairs which are best for use in a big room"
          }
        }
      },
      "archiveDemand": {
        "type": "object",
        "properties": {
          "demandIds": {
            "type": "array",
            "description": "An array of demand IDs to be archived",
            "items": {
              "type": "string",
              "format": "uuid",
              "example": "83da61b6-e11e-495d-9808-3e1ff7869c19"
            }
          }
        }
      },
      "addOffer": {
        "type": "object",
        "description": "An item which needs to be procured (a purchase requisition).",
        "properties": {
          "demandOffer":{
            "type": "object",
            "description": "Demand offers list",
            "required": ["supplier", "unitPrice"],
            "properties": {
              "supplier": {
                "allOf": [
                  {
                    "$ref": "#/components/schemas/supplier"
                  }
                ]
              },
              "unitPrice": {
                "description": "The price for a single unit of the demand.",
                "allOf": [ { "$ref": "#/components/schemas/price" } ]
              },
              "attachments": {
                "description": "Attachments list",
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "content": {
                      "type": "string",
                      "format": "base64",
                      "example": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAcCAYAAAB"
                    },
                    "name": {
                      "type": "string",
                      "example": "example.pdf"
                    }
                  }
                }
              }
            }
          }
        },
        "required": ["demandOffer"]
      },
      "baseResponseDemand": {
        "type": "object",
        "description": "A demand which has been saved in the mysupply DB",
        "properties": {
          "title": {
            "type": "string",
            "description": "A brief explanation of the demand.",
            "example": "Office Chairs"
          },
          "quantity": {
            "allOf": [ { "$ref": "#/components/schemas/decimal" } ],
            "description": "The quantity needed.",
            "example": 20
          },
          "unitOfMeasure": {
            "allOf": [ { "$ref": "#/components/schemas/unitOfMeasure" } ],
            "example": "piece"
          },
          "demandSuppliers":{
            "type": "array",
            "description": "Suppliers list",
            "items": {
              "type": "object",
              "properties": {
                "email" : {
                  "type": "string",
                  "description": "Supplier email address",
                  "example": "supplier@email.com"
                }
              }
            }
          },
          "demandOffers":{
            "type": "object",
            "description": "Demand offers list",
            "required": ["supplier", "unitPrice"],
            "properties": {
              "supplier": {
                "allOf": [ { "$ref": "#/components/schemas/supplier" } ]
              },
              "unitPrice": {
                "description": "The price for a single unit of the demand.",
                "allOf": [ { "$ref": "#/components/schemas/price" } ]
              },
              "attachments": {
                "description": "Attachments list",
                "allOf": [ { "$ref": "#/components/schemas/attachments" } ]
              }
            }
          },
          "fields": {
            "description": "Custom fields list",
            "allOf": [ { "$ref": "#/components/schemas/responseFields" } ]
          }
        }
      },
      "savedDemand": {
        "allOf": [
          { "$ref": "#/components/schemas/baseResponseDemand" },
          {
            "type": "object",
            "description": "A demand which has been saved in the mysupply DB",
            "properties": {
              "id": {
                "type": "string",
                "readOnly": true,
                "description": "The mysupply ID of the demand",
                "example": "83da61b6-e11e-495d-9808-3e1ff7869c19"
              },
              "status": {
                "enum": ["awaiting", "processing", "processed", "archived"],
                "readOnly": true,
                "description": "The status of the demand.",
                "example": "processed"
              }
            }
          }
        ]
      },
      "editedDemand": {
        "allOf": [
          { "$ref": "#/components/schemas/baseResponseDemand" },
          {
            "type": "object",
            "description": "A demand which has been edited in the mysupply DB"
          }
        ]
      },
      "unitOfMeasure": {
        "type": "string",
        "description": "The unit of measure for the quantity needed.",
        "enum": [
          "centimeter",
          "cubic-centimeter",
          "cubic-meter",
          "gram",
          "meter",
          "millimeter",
          "square-meter",
          "kilogram",
          "kilowatt-hour",
          "liter",
          "piece",
          "square-centimeter",
          "ton",
          "minute",
          "hour",
          "day",
          "month",
          "other"
        ],
        "example": "piece"
      },
      "deal": {
        "type": "object",
        "readOnly": true,
        "nullable": true,
        "description": "Information about the supplier delivering the item and the price of the deal",
        "properties": {
          "demandId": {
            "type": "string",
            "readOnly": true,
            "description": "Demand ID",
            "format": "uuid"
          },
          "hasDeal": {
            "type": "boolean",
            "readOnly": true,
            "description": "Deal existing"
          },
          "unitPrice": {
            "readOnly": true,
            "nullable": true,
            "description": "The price for a single unit of the demand.",
            "allOf": [ { "$ref": "#/components/schemas/price" } ]
          },
          "totalPrice": {
            "readOnly": true,
            "nullable": true,
            "description": "The price for the demand.",
            "allOf": [ { "$ref": "#/components/schemas/price" } ]
          },
          "supplier": {
            "nullable": true,
            "readOnly": true,
            "type": "object",
            "description": "Information about the supplier delivering the demand",
            "properties": {
              "email": {
                "type": "string",
                "readOnly": true,
                "example": "the-best@chairs.com"
              },
              "supplierNumber": {
                "type": "string",
                "readOnly": true,
                "description": "The supplier number provided by the purchaser's organization. If no such number is provided, a default one will be set",
                "example": "sup-99310"
              },
              "companyName": {
                "type": "string",
                "readOnly": true,
                "description": "The name of the company of the supplier as provided by the supplier.",
                "example": "The Best Chairs & Sons Ltd."
              }
            }
          }
        }
      },
      "price": {
        "type": "object",
        "description": "A monetary value.",
        "properties": {
          "amount": { "$ref": "#/components/schemas/decimal" },
          "currency": {
            "type": "string",
            "description": "The currency code of the monetary value.",
            "example": "EUR"
          }
        }
      },
      "decimal": {
        "type": "string",
        "format": "{1,9}+(\\.\\d+)?",
        "description": "A decimal string representation of a number with fixed precision.",
        "example": "17.05"
      },
      "supplier": {
        "type": "object",
        "required": [ "email" ],
        "properties": {
          "email": {
            "type": "string",
            "description": "Supplier email address",
            "example": "supplier@email.com"
          },
          "number": {
            "type": "string",
            "description": "Supplier number"
          },
          "name": {
            "type": "string",
            "nullable": true,
            "description": "Supplier name"
          }
        }
      },
      "attachments": {
        "description": "Attachments list",
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "id": {
              "type": "string",
              "format": "uuid",
              "example": "38beff27-33ed-4ee0-bd17-fd75a6f9db3c"
            },
            "fileName": {
              "type": "string",
              "example": "example.pdf"
            },
            "mimeType": {
              "type": "string",
              "example": "image/png"
            },
            "size": {
              "type": "integer",
              "example": 500
            }
          }
        }
      },
      "baseFields": {
        "description": "Arbitrary data related to the item.",
        "type": "array",
        "items": {
          "type": "object",
          "description": "A single field with extra information about the demand.",
          "required": ["name", "value", "public"],
          "properties": {
            "name": {
              "type": "string",
              "description": "The name of the field.",
              "example": "lastPrice"
            },
            "value": {
              "description": "The value of the field, which can vary significantly depending on the type. It can be a simple string, a complex structured object, a specific schema-defined object (like price, address, or attachment), or an array containing any combination of strings, objects, or arrays."
            },
            "public": {
              "type": "boolean",
              "description": "If ture - the field will be displayed to supplier. Otherwise, the field will be visible only to members of the purchasing organization.",
              "example": false
            },
            "type": {
              "enum": ["text", "date", "number", "total_price", "unit_price", "address", "attachment"],
              "default": "text",
              "description": "Specifies the expected data type of the 'value' field and determines how the system renders and validates the input. This property guides the format and validation rules for the 'value'. Each predefined type has specific requirements:\n- **text**: Expect a simple string. Suitable for general text.\n- **date**: The 'value' should be a string formatted as an ISO 8601 date.\n- **number**: Expect a numeric value formatted as a string.\n- **total_price**, **unit_price**: The 'value' should conform to the 'price' schema, typically including properties like 'amount' and 'currency'.\n- **address**: The 'value' must match the 'address' schema, including details such as country, region, city, etc.\n- **attachment**: Expect an 'attachment' object containing properties like 'fileName' and 'data', where 'data' is base64-encoded content of the file.\n- **custom**: Any other type of data defined by the user, allowing for maximum flexibility. The system will accept any valid JSON value (string, number, object, array, boolean, or null) based on user needs and context. This setting should be used when the data does not fit any other predefined types and requires custom handling.",
              "example": "price"
            }
          }
        }
      },
      "requestFields": {
        "allOf": [
          { "$ref": "#/components/schemas/baseFields" },
          {
            "items": {
              "properties": {
                "value": {
                  "oneOf": [
                    {
                      "type": "string",
                      "description": "Used for text, date, and number types."
                    },
                    { "$ref": "#/components/schemas/price" },
                    { "$ref": "#/components/schemas/address" },
                    { "$ref": "#/components/schemas/requestAttachment" },
                    {
                      "type": "object",
                      "additionalProperties": true,
                      "description": "Any other object with free-form properties."
                    }
                  ]
                }
              }
            }
          }
        ]
      },
      "editRequestFields": {
        "allOf": [
          { "$ref": "#/components/schemas/requestFields" },
          {
            "items": {
              "properties": {
                "id": {
                  "type": "string",
                  "description": "the id",
                  "example": "b97d2783-d1d5-4947-ac7d-0e3182b9d6fb"
                }
              }
            }
          }
        ]
      },
      "responseFields": {
        "allOf": [
          { "$ref": "#/components/schemas/baseFields" },
          {
            "items": {
              "properties": {
                "value": {
                  "oneOf": [
                    {
                      "type": "string",
                      "description": "Used for text, date, and number types."
                    },
                    { "$ref": "#/components/schemas/price" },
                    { "$ref": "#/components/schemas/address" },
                    { "$ref": "#/components/schemas/responseAttachment" },
                    {
                      "type": "object",
                      "additionalProperties": true,
                      "description": "Any other object with free-form properties."
                    }
                  ]
                },
                "id": {
                  "type": "string",
                  "description": "The id of the field saved in the database",
                  "example": "b97d2783-d1d5-4947-ac7d-0e3182b9d6fb"
                }
              }
            }
          }
        ]
      },
      "address": {
        "type": "object",
        "description": "The address.",
        "properties": {
          "country": {
            "type": "string",
            "description": "Country",
            "example": "Germany"
          },
          "region": {
            "type": "string",
            "description": "Region"
          },
          "city": {
            "type": "string",
            "description": "The city of the address",
            "example": "Berlin"
          },
          "postalCode": {
            "type": "string",
            "description": "The postal code of the address",
            "example": "1142"
          },
          "streetAddress1": {
            "type": "string",
            "description": "The street address"
          },
          "streetAddress2": {
            "type": "string",
            "description": "The street address"
          }
        }
      },
      "requestAttachment": {
        "type": "object",
        "description": "An attachment object representing a file to be associated with a request or data entry. The file data is expected to be in base64-encoded format, which allows binary data to be transmitted as a string. This format supports a wide range of file types, from plain text documents to images and complex binary files. The 'fileName' property should provide the original file name, helping to identify the file type and intended use. The 'data' property should contain the actual file content encoded in base64, suitable for transmission and storage in JSON.",
        "properties": {
          "fileName": {
            "type": "string",
            "description": "The name of the attachment",
            "example": "AttachmentName.txt"
          },
          "data": {
            "type": "string",
            "description": "The file content encoded in base64. This encoding ensures that binary data can be safely transmitted over media that are designed to deal with textual data. It allows complex files such as images or PDFs to be transferred as part of the JSON object.",
            "example": "data:text/plain;base64,VGhpcyBpcyBhIG5ldyB0ZXN0IGZpbGUgd2l0aCBzb21lIGNvbnRlbnQuIEl0IHNob3VsZCBiZSBkaWZmZXJlbnQgZnJvbSB0aGUgb25lIHdlIGhhdmUgYWxyZWFkeQ=="
          }
        }
      },
      "responseAttachment": {
        "type": "object",
        "description": "An attachment object representing a file to be associated with a request or data entry. The file data is expected to be in base64-encoded format, which allows binary data to be transmitted as a string. This format supports a wide range of file types, from plain text documents to images and complex binary files. The 'fileName' property should provide the original file name, helping to identify the file type and intended use. The 'data' property should contain the actual file content encoded in base64, suitable for transmission and storage in JSON.",
        "properties": {
          "fileName": {
            "type": "string",
            "description": "The name of the attachment",
            "example": "AttachmentName.txt"
          },
          "mimeType": {
            "type": "string",
            "description": "The file content encoded in base64. This encoding ensures that binary data can be safely transmitted over media that are designed to deal with textual data. It allows complex files such as images or PDFs to be transferred as part of the JSON object.",
            "example": "text/plain"
          },
          "size": {
            "type": "integer",
            "description": "The size of the file",
            "example": "94"
          }
        }
      }
    }
  }
}
