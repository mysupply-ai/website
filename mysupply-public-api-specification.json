{
  "openapi": "3.0.3",
  "info": {
    "title": "mysupply Public API",
    "version": "0.1.0"
  },
  "servers": [
    {
      "url": "/v1"
    }
  ],
  "security": [
    {
      "BearerAuth": []
    }
  ],
  "paths": {
    "/demands": {
      "post": {
        "summary": "Submit a new demand",
        "description": "",
        "tags": ["Demands"],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "allOf": [
                  {
                    "$ref": "#/components/schemas/demand"
                  }
                ],
                "required": ["title", "quantity", "unitOfMeasure"]
              },
              "example": {
                "title": "Office Chairs",
                "quantity": 20,
                "unitOfMeasure": "piece",
                "extraFields": {
                  "internalId": "8937182",
                  "deliveryDate": "2043-06-25"
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Demand was created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "description": "The mysupply ID assigned to the demand",
                      "type": "string"
                    }
                  }
                },
                "example": {
                  "id": "83da61b6-e11e-495d-9808-3e1ff7869c19"
                }
              }
            }
          },
          "400": {
            "description": "Invalid input"
          },
          "422": {
            "description": "Unprocessable entity"
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    },
    "/demands/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "The mysupply ID of the demand",
          "required": true,
          "allowEmptyValue": false,
          "schema": {
            "type": "string"
          },
          "example": "/demands/83da61b6-e11e-495d-9808-3e1ff7869c19"
        }
      ],
      "get": {
        "tags": ["Demands"],
        "summary": "Returns information for a specific demand",
        "responses": {
          "200": {
            "description": "Information for the demand",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [{ "$ref": "#/components/schemas/demand" } ],
                  "properties": {
                    "id": {
                      "type": "string",
                      "description": "The mysupply ID of the demand.",
                      "readOnly": true
                    },
                    "workflowId": {
                      "type": "string",
                      "nullable": true,
                      "description": "If the demand is being processed in a workflow, this will be the mysupply ID of the workflow processing the demand. Null otherwise."
                    }
                  }
                },
                "example": {
                  "id": "83da61b6-e11e-495d-9808-3e1ff7869c19",
                  "workflowId": "516c4b59-96c3-4bc9-8694-477890fc2543",
                  "title": "Office Chairs",
                  "quantity": 20,
                  "unitOfMeasure": "piece",
                  "extraFields": {
                    "internalId": "8937182",
                    "deliveryDate": "2043-06-25"
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          },
          "404": {
            "description": "A demand with such ID has not been found"
          }
        }
      }
    },
    "/workflow/{id}": {
      "parameters": [
        {
          "name": "id",
          "in": "path",
          "description": "The mysupply ID of a workflow",
          "required": true,
          "allowEmptyValue": false,
          "schema": {
            "type": "string"
          },
          "example": "/workflow/516c4b59-96c3-4bc9-8694-477890fc2543"
        }
      ],
      "get": {
        "tags": ["Workflow"],
        "responses": {
          "404": {
            "description": "A workflow with this ID was not found"
          },
          "200": {
            "description": "Information for the workflow",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "description": "The mysupply ID of the worklfow"
                    },
                    "requestFroProposals": {
                      "type": "object",
                      "properties": {
                        "requestItems": {
                          "type": "array",
                          "description": "An array of items sought to be procured with this request",
                          "items": {
                            "type": "object",
                            "properties": {
                              "id": {
                                "type": "string",
                                "description": "The mysupply ID or this request item for reference in the workflow."
                              },
                              "title": {
                                "type": "string",
                                "description": "The title/name of the item"
                              },
                              "amount": {
                                "type": "number",
                                "description": "The number/amount of the item sought to be procured"
                              },
                              "unitOfMeasure": {
                                "$ref": "#/components/schemas/unitOfMeasure"
                              },
                              "demandIds": {
                                "type": "array",
                                "description": "The IDs of the demands from which this request item has been derived from if any.",
                                "items": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        }
                      }
                    },
                    "suppliers": {
                      "type": "array",
                      "description": "The suppliers which have been invited to submit responses to the request.",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "description": "A mysupply ID of the supplier for reference in the workflow"
                          },
                          "supplierNumber": {
                            "type": "string",
                            "description": "A client provided supplier number/identificator. Null if non is provided.",
                            "nullable": true
                          },
                          "inviteeEmail": {
                            "type": "string",
                            "description": "The email which was used to send the invitation to."
                          }
                        }
                      }
                    },
                    "deals": {
                      "type": "array",
                      "description": "The deals made with suppliers after the end of the respective negotiations",
                      "items": {
                        "type": "object",
                        "properties": {
                          "dealId": {
                            "type": "string",
                            "description": "The mysupply ID of the deal"
                          },
                          "supplierId": {
                            "type": "string",
                            "description": "The mysupply ID of the invited supplier"
                          },
                          "totalPrice": {
                            "description": "The negotiated total price for the items in this deal.",
                            "allOf": [
                              {
                                "$ref": "#/components/schemas/price"
                              }
                            ]
                          },
                          "dealItems": {
                            "type": "array",
                            "description": "The request items included in this deal along with their negotiated single unit prices.",
                            "items": {
                              "type": "object",
                              "properties": {
                                "requestItemId": {
                                  "type": "string",
                                  "description": "The mysuply ID of the requested item"
                                },
                                "singleUnitPrice": {
                                  "description": "The negotiated single unit price for the item.",
                                  "allOf": [
                                    {
                                      "$ref": "#/components/schemas/price"
                                    }
                                  ]
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "example": {
                  "id": "516c4b59-96c3-4bc9-8694-477890fc2543",
                  "requestForProposals": {
                    "requestItems": [
                      {
                        "id": "af33094c-3e19-42e7-9af0-4a488f841ec7",
                        "title": "Office Chairs",
                        "amount": 20,
                        "unitOfMeasure": "piece",
                        "demandIds": ["83da61b6-e11e-495d-9808-3e1ff7869c19"]
                      },
                      {
                        "id": "cd75b234-23cb-4b65-86e3-8c2181328f64",
                        "title": "White Boards",
                        "amount": 2,
                        "unitOfMeasure": 2,
                        "demandIds": []
                      }
                    ]
                  },
                  "suppliers": [
                    {
                      "id": "0ca6d249-1617-4835-83c6-1b4a87a9cfa8",
                      "supplierNumber": "355612",
                      "inviteeEmail": "sup1@example.com"
                    },
                    {
                      "id": "61521fad-dbcf-44c7-9113-58caf9aa3f85",
                      "supplierNumber": "556319",
                      "inviteeEmail": "sup_good@example.com"
                    }
                  ],
                  "deals": [
                    {
                      "dealId": "086ba482-a179-4eec-9603-5bea04df3eea",
                      "supplierId": "61521fad-dbcf-44c7-9113-58caf9aa3f85",
                      "totalPrice": {
                        "amount": "1900",
                        "currency": "EUR"
                      },
                      "dealItems": [
                        {
                          "requestItemId": "af33094c-3e19-42e7-9af0-4a488f841ec7",
                          "singleUnitPrice": {
                            "amount": "950",
                            "currency": "EUR"
                          }
                        }
                      ]
                    },
                    {
                      "dealId": "dfea1579-ea6f-4600-a96e-fdb4034bea87",
                      "supplierId": "0ca6d249-1617-4835-83c6-1b4a87a9cfa8",
                      "totalPrice": {
                        "amount": "200",
                        "currency": "EUR"
                      },
                      "dealItems": [
                        {
                          "requestItemId": "cd75b234-23cb-4b65-86e3-8c2181328f64",
                          "totalPrice": {
                            "amount": "100",
                            "currency": "EUR"
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/UnauthorizedError"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "responses": {
      "UnauthorizedError": {
        "description": "Access token is missing or invalid"
      }
    },
    "schemas": {
      "demand":  {
        "type": "object",
        "description": "An item which needs to be procured.",
        "properties": {
          "title": {
            "type": "string",
            "description": "A brief explanation of the item."
          },
          "quantity": {
            "type": "number",
            "description": "The quantity needed."
          },
          "unitOfMeasure": {
            "allOf": [ { "$ref": "#/components/schemas/unitOfMeasure" } ]
          },
          "extraFields": {
            "description": "Arbitrary data related to the item.",
            "type": "object"
          }
        }
      },
      "unitOfMeasure": {
        "type": "string",
        "description": "The unit of measure for the quantity needed.",
        "enum": [
          "centimeter",
          "cubic-centimeter",
          "cubic-meter",
          "gram",
          "meter",
          "millimeter",
          "square-meter",
          "kilogram",
          "kilowatt-hour",
          "liter",
          "piece",
          "square-centimeter",
          "ton",
          "minute",
          "hour",
          "day",
          "month",
          "other"
        ]
      },
      "price": {
        "type": "object",
        "description": "A monetary value.",
        "properties": {
          "amount": {
            "type": "string",
            "format": "{1,9}+(\\.\\d+)?",
            "description": "A decimal string representation of the amount of the monetary value.",
            "example": "17.05"
          },
          "currency": {
            "type": "string",
            "description": "The currency code of the monetary value.",
            "example": "EUR"
          }
        }
      }
    }
  }
}
